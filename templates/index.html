<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulasi Dinamika Stok Es Teh Jumbo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #020617;
            --card: #020617;
            --card-soft: #0b1120;
            --accent: #22c55e;
            --accent-soft: rgba(34, 197, 94, 0.12);
            --accent-strong: #4ade80;
            --text: #e5e7eb;
            --muted: #9ca3af;
            --border: #1f2937;
            --danger: #f97373;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #1e293b 0, #020617 45%, #000 100%);
            color: var(--text);
        }

        .page-shell {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 16px 48px;
        }

        .header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 24px;
        }

        .title-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        h1 {
            font-size: 26px;
            font-weight: 600;
            letter-spacing: 0.02em;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.13em;
            padding: 3px 8px;
            border-radius: 999px;
            background: var(--accent-soft);
            color: var(--accent-strong);
            border: 1px solid rgba(34,197,94,0.35);
        }

        .subtitle {
            font-size: 13px;
            color: var(--muted);
            max-width: 640px;
        }

        .grid-main {
            display: grid;
            grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.6fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 900px) {
            .grid-main { grid-template-columns: minmax(0, 1fr); }
        }

        .card {
            background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.88));
            border-radius: 18px;
            border: 1px solid rgba(148,163,184,0.25);
            box-shadow: 0 18px 45px rgba(15,23,42,0.85);
            padding: 18px 18px 16px;
        }

        .card-soft {
            background: radial-gradient(circle at top left, rgba(34,197,94,0.08), transparent 60%),
                        linear-gradient(135deg, #020617, #020617);
            border-radius: 18px;
            border: 1px solid rgba(31,41,55,0.9);
            padding: 18px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 500;
        }

        .card-caption {
            font-size: 11px;
            color: var(--muted);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 12px;
            margin-top: 8px;
        }

        @media (max-width: 720px) {
            .form-grid { grid-template-columns: minmax(0, 1fr); }
        }

        label {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 4px;
            display: inline-block;
        }

        .input-wrapper {
            background: rgba(15,23,42,0.7);
            border-radius: 12px;
            border: 1px solid rgba(31,41,55,0.85);
            padding: 8px 10px 6px;
        }

        input[type="number"] {
            width: 100%;
            border: none;
            background: transparent;
            color: var(--text);
            font-size: 13px;
            outline: none;
        }

        .btn-row {
            margin-top: 14px;
            display: flex;
            justify-content: flex-end;
        }

        button[type="submit"] {
            border-radius: 999px;
            border: none;
            padding: 8px 18px;
            font-size: 13px;
            font-weight: 500;
            background: linear-gradient(135deg, var(--accent), var(--accent-strong));
            color: #022c22;
            cursor: pointer;
            box-shadow: 0 12px 30px rgba(34,197,94,0.45);
        }

        button[type="submit"]:hover {
            opacity: 0.95;
        }

        .chips-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .chip {
            font-size: 11px;
            padding: 4px 9px;
            border-radius: 999px;
            border: 1px dashed rgba(148,163,184,0.6);
            color: var(--muted);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px;
            margin-top: 6px;
        }

        @media (max-width: 900px) {
            .summary-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }

        @media (max-width: 640px) {
            .summary-grid { grid-template-columns: minmax(0, 1fr); }
        }

        .stat-card {
            background: rgba(15,23,42,0.9);
            border-radius: 14px;
            border: 1px solid rgba(31,41,55,0.9);
            padding: 10px 11px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--muted);
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            margin-top: 3px;
        }

        .stat-pill {
            font-size: 11px;
            color: #22c55e;
            background: rgba(34,197,94,0.1);
            border-radius: 999px;
            padding: 2px 8px;
            display: inline-block;
            margin-top: 4px;
        }

        .stat-danger {
            color: var(--danger);
            background: rgba(248,113,113,0.1);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: minmax(0, 1fr);
            gap: 14px;
        }

        .chart-container {
            position: relative;
            height: 220px;
        }

        .table-card {
            margin-top: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        thead {
            background: rgba(15,23,42,0.98);
        }

        th, td {
            padding: 7px 8px;
            border-bottom: 1px solid rgba(31,41,55,0.9);
            text-align: right;
        }

        th:first-child, td:first-child { text-align: left; }

        tbody tr:nth-child(odd) {
            background: rgba(15,23,42,0.7);
        }

        tbody tr:nth-child(even) {
            background: rgba(15,23,42,0.4);
        }

        .tag-small {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.5);
            color: var(--muted);
        }
    </style>
</head>
<body>
    <div class="page-shell">
        <header class="header">
            <div class="title-row">
                <h1>
                    Simulasi Dinamika Stok Es Teh Jumbo
                    <span class="badge">System Dynamics</span>
                </h1>
            </div>
            <p class="subtitle">
                Eksplorasi perilaku persediaan dari waktu ke waktu dengan mengatur <em>initial stock</em>,
                ambang pemesanan ulang (<em>reorder threshold</em>), dan jumlah restock. Hasil divisualisasikan
                dalam bentuk tabel, grafik stok dan penjualan, serta ringkasan indikator kinerja sistem.
            </p>
        </header>

        <div class="grid-main">
            <section class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Parameter Simulasi</div>
                        <div class="card-caption">Atur kebijakan persediaan untuk melihat dampaknya terhadap stok dan penjualan.</div>
                    </div>
                </div>

                <form method="post">
                    <div class="form-grid">
                        <div>
                            <label for="initial_stock">Initial Stock (unit)</label>
                            <div class="input-wrapper">
                                <input type="number" id="initial_stock" name="initial_stock" min="0" step="1" value="{{ initial_stock }}" required>
                            </div>
                        </div>
                        <div>
                            <label for="threshold">Threshold Restock (unit)</label>
                            <div class="input-wrapper">
                                <input type="number" id="threshold" name="threshold" min="0" step="1" value="{{ threshold }}" required>
                            </div>
                        </div>
                        <div>
                            <label for="restock_amount">Jumlah Restock (unit)</label>
                            <div class="input-wrapper">
                                <input type="number" id="restock_amount" name="restock_amount" min="0" step="1" value="{{ restock_amount }}" required>
                            </div>
                        </div>
                    </div>

                    <div class="chips-row">
                        <span class="chip">Aliran keluar: penjualan harian (demand)</span>
                        <span class="chip">Aliran masuk: restock ketika stok â‰¤ threshold</span>
                        <span class="chip">State variable: level stok harian</span>
                    </div>

                    <div class="btn-row">
                        <button type="submit">Jalankan Simulasi</button>
                    </div>
                </form>
            </section>

            <section class="card-soft">
                <div class="card-header">
                    <div>
                        <div class="card-title">Ringkasan Kinerja Sistem</div>
                        <div class="card-caption">Indikator utama hasil simulasi dinamika persediaan.</div>
                    </div>
                </div>

                <div class="summary-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Permintaan Penjualan</div>
                        <div class="stat-value">{{ summary.total_penjualan_permintaan }}</div>
                        <div class="stat-pill">Unit yang diminta pasar</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Penjualan Terpenuhi</div>
                        <div class="stat-value">{{ summary.total_penjualan_terpenuhi }}</div>
                        <div class="stat-pill">Demand yang berhasil dilayani</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Penjualan Tidak Terlayani</div>
                        <div class="stat-value">{{ summary.total_penjualan_tidak_terlayani }}</div>
                        <div class="stat-pill stat-danger">Kehilangan penjualan (stockout)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Jumlah Hari Restock</div>
                        <div class="stat-value">{{ summary.jumlah_hari_restock }}</div>
                        <div class="stat-pill">Frekuensi aktivasi kebijakan restock</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Unit Restock</div>
                        <div class="stat-value">{{ summary.total_unit_restock }}</div>
                        <div class="stat-pill">Akumulasi aliran masuk persediaan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Stok Rata-rata</div>
                        <div class="stat-value">{{ '%.1f'|format(summary.stok_rata_rata) }}</div>
                        <div class="stat-pill">Level persediaan rata-rata harian</div>
                    </div>
                </div>
            </section>
        </div>

        <section class="card table-card">
            <div class="card-header">
                <div>
                    <div class="card-title">Grafik Dinamika Stok & Penjualan</div>
                    <div class="card-caption">Visualisasi perilaku stok (level) dan penjualan (aliran keluar) sepanjang horizon waktu.</div>
                </div>
                <span class="tag-small">{{ data|length }} periode waktu</span>
            </div>

            <div class="charts-grid">
                <div>
                    <div class="card-caption" style="margin-bottom:4px;">Perilaku Level Stok</div>
                    <div class="chart-container">
                        <canvas id="stockChart"></canvas>
                    </div>
                </div>
                <div>
                    <div class="card-caption" style="margin-bottom:4px;">Penjualan Terpenuhi per Periode</div>
                    <div class="chart-container">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section class="card table-card">
            <div class="card-header">
                <div>
                    <div class="card-title">Tabel Hasil Simulasi</div>
                    <div class="card-caption">Detail per periode: permintaan, penjualan terpenuhi, penjualan hilang, restock, dan level stok.</div>
                </div>
            </div>

            <div style="max-height: 340px; overflow: auto; border-radius: 12px; border: 1px solid rgba(31,41,55,0.9);">
                <table>
                    <thead>
                        <tr>
                            <th>Periode</th>
                            <th>Tanggal</th>
                            <th>Permintaan (sales)</th>
                            <th>Penjualan Terpenuhi</th>
                            <th>Penjualan Hilang</th>
                            <th>Restock</th>
                            <th>Stok Akhir</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in data %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ row.date if row.date is defined else '-' }}</td>
                            <td>{{ row.sales }}</td>
                            <td>{{ row.sales_realized }}</td>
                            <td>{{ row.sales_lost }}</td>
                            <td>{{ row.restock }}</td>
                            <td>{{ row.stock_after_simulation }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        const labels = {{ chart_labels | tojson }};
        const stockData = {{ chart_stock | tojson }};
        const salesData = {{ chart_sales | tojson }};

        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: {
                    labels: {
                        color: '#e5e7eb',
                        font: { size: 11 }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(15,23,42,0.96)',
                    borderColor: 'rgba(148,163,184,0.5)',
                    borderWidth: 1,
                    titleFont: { size: 12 },
                    bodyFont: { size: 11 }
                }
            },
            scales: {
                x: {
                    ticks: { color: '#9ca3af', maxTicksLimit: 10 },
                    grid: { color: 'rgba(31,41,55,0.5)' }
                },
                y: {
                    ticks: { color: '#9ca3af' },
                    grid: { color: 'rgba(31,41,55,0.5)' }
                }
            }
        };

        const stockCtx = document.getElementById('stockChart').getContext('2d');
        new Chart(stockCtx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Stok Akhir',
                        data: stockData,
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34,197,94,0.2)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.25,
                        fill: true
                    }
                ]
            },
            options: commonOptions
        });

        const salesCtx = document.getElementById('salesChart').getContext('2d');
        new Chart(salesCtx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Penjualan Terpenuhi',
                        data: salesData,
                        backgroundColor: 'rgba(59,130,246,0.8)'
                    }
                ]
            },
            options: commonOptions
        });
    </script>
</body>
</html>
